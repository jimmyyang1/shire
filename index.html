<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Just Shire Things</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>

	</head>

	<body>
	<header>
		<h1>Just Shire Things</h1>
	</header>
	<div id="content">
	</div>
	<script type="text/babel">


		function clean_google_sheet_json(data){
			var formatted_json = [];
			var elem = {};
			var real_keyname = '';
			$.each(data.feed.entry, function(i, entry) {
				elem = {};
				$.each(entry, function(key, value){
					// fields that were in the spreadsheet start with gsx$
					if (key.indexOf("gsx$") == 0) 
					{
						// get everything after gsx$
						real_keyname = key.substring(4); 
						elem[real_keyname] = value['$t'];
					}
				});
				formatted_json.push(elem);
			});
			return formatted_json;
		};	
		var QuoteContainer = React.createClass({
			getInitialState: function(){
				return {data:[]};
			},
			componentDidMount: function(){
				$.getJSON(this.props.url, function(json){

					this.setState({data:clean_google_sheet_json(json)});

				}.bind(this));
			},
			render: function(){

				var quoteNodes = this.state.data.map(function(myQuotes){
					return(
						<Quote myAuthor={myQuotes.author}>
							{myQuotes.text}
						</Quote>
					)
				})
				return(
					<div className="QuoteContainer">
						{quoteNodes}
					</div>
				)
			}
		})
		var Quote = React.createClass({
			render: function(){
				return(
					<div className="quoteBody">
						<h2 className="quoteAuthor">
							{this.props.myAuthor}
						</h2>
						{this.props.children}
					</div>
				)
			}
		})



		ReactDOM.render(
		  <QuoteContainer url="https://spreadsheets.google.com/feeds/list/1m1dmaFdFACRzloJQZAssirckGMdxNIYqD5o-ugSwc3g/od6/public/values?alt=json"/>,
		  document.getElementById('content')
		);


	</script>
	</body>

</html>